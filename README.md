
# Cloud Sync

Синхронизатор файлов между локальным хранилищем и Google Drive.

## Установка

У вас должны быть установлены Node.js версией 14 и npm версией 11.1 или более поздними. 

1. Клонирование репозитория 

```git clone https://github.com/KinStown/Cloud-Sync```

2. Переход в папку проекта

```cd Cloud-Sync```

3. Установка зависимостей

```npm i @googleapis/drive@8.14.0 dotenv@16.4.7 minimist@1.2.8```

## Подготовка

1. Создание сервисного аккаунта

Перед запуском необходимо создать проект и к нему добавить Service Account на странице [Google Console](https://console.cloud.google.com/apis/credentials). Как это сделать можно посмотреть [тут](https://cloud.google.com/iam/docs/service-accounts-create) и [тут](https://gist.github.com/br4instormer/23745134ea82e9ce0a96b173bd3f2e6e).

2. Создание файла конфигурации

После создайте файл .env в папке с исполняемыми файлами, [вот пример](./docs/.env.example).
- `defaultFolderId` - указывает Id основный (корневой) папки на Google Drive. 
- `tokenPath` - задаёт путь к json файлу, созданному в пункте 1. 
- `dLocalFolder` - указывает на путь к локальной папке на устройстве, с которой будет проходить синхронизация. 
- `whitelist` - строка, состоящая из путей к файлам или папкам, разделенные знаком `;`, с которыми будут происходить операции. Параметр является опциональным и по умолчанию используются все папки, находящиеся в `dLocalFolder`.

## Запуск

1. Запуск основного файла

```node index.js```

У программы есть 3 типа работы, которые указываются параметром `type` (по умолчанию - `All`):
- U - обновление файлов в облако
- D - скачивание файлов с облака в локальное хранилище
- All - включает в себя все методы

Пример использования:

```node index.js --type U```

Программа возьмет параметры из файла .env, который находится в папке запускаемых файлов. Вы можете использовать альтернативные способы, чтобы задать необходимые параметры:

- Использовать файл .env, не находящийся в одной папке с программой

```node index.js --env .\path\to\.env```

- Либо можно указать параметры при запуске

```node index.js --defaultFolderId DRIVE-FOLDER-ID --tokenPath .\path\to\token.json --dLocalFolder ".\path\to\folder" --whitelist=".\path\to\folder"```

В случае, если параметры не указаны ни одним из методов, программа выдаст ошибку.

2. Запуск с использованием инструментов отладки

```node starter.js```

Такой запуск добавляет ожидание выхода из программы после завершения работы и счетчики скачивания, загрузки и проверки на загрузку.

## Компиляция

Проект расчитан на компиляцию, поэтому далее будет описан один из методов компиляции. Выбран модуль [pkg](https://www.npmjs.com/package/pkg) из-за возможности компиляции всех модулей в один исполняемый файл.

Для компиляции можно использовать версии Node.js от 14. Файл `.env` обязательно должен находиться в одной папке с исполняемыми файлами. 

- Установка компилятора pkg

```npm i -g pkg```

- Компиляция проекта

```pkg -t node14-win starter.js -o output.exe```

В случае, если инструменты для отладки не понадобятся, то можно использовать `index.js` для компиляции.

## Особенности

- Программа автоматически пропускает файлы и папки, название которых начинается со знака восклицания (!). Избежать этого можно, добавив путь в параметр `whitelist`
- Программа использует функцию `print` для корректного отображения счетчиков в консоли, которая отличается функционалом от `console.log`. Если вы не будете использовать файл `starter.js`, то можете использовать как `print`, так и `console.log`.

## Поддержка
Если у вас возникли сложности или вопросы по использованию проекта, создайте 
[обсуждение](https://github.com/KinStown/Cloud-Sync/issues/new/choose) в данном репозитории.